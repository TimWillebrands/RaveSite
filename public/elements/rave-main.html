<link rel="import" href="/bower/polymer/polymer.html">
<link rel="import" href="/public/elements/rave-sidebar.html">
<link rel="import" href="/public/elements/rave-item-pages.html">
<link rel="import" href="/bower/core-pages/core-pages.html">
<link rel="import" href="/public/elements/rave-item-button.html">

<polymer-element name="rave-main" attributes="selected" fit horizontal layout>
    <template>
        <style type="text/css">
            rave-sidebar{
                width: 10em;
                margin: 3em;
                margin-left: 2em;
            }
        </style>
        <rave-sidebar selected="{{selected}}"></rave-sidebar>
        <core-pages flex selected="{{selected}}" valueattr="tag">
            <rave-item-pages id="rave" tag="rave"></rave-item-pages>
            <rave-item-pages tag="werk"></rave-item-pages>
            <rave-item-pages tag="contact"></rave-item-pages>
        </core-pages>
    </template>
    <script>
        /*global Polymer*/
        Polymer('rave-main', {
            image: "https://farm4.staticflickr.com/3847/15188820565_1d8d2f0e8c_o.png",
            selectedChanged: function(o,n){
            },
            ready: function() {
                var tags = [];
                var itemsHolder  = this.$.rave;
                tags.push(this.tag);
                var ajax = document.createElement('core-ajax');
                ajax.method = "POST";
                ajax.url = "/item";
                ajax.body = JSON.stringify(tags);
                ajax.handleAs = "json";
                ajax.contentType = "application/json";
                ajax.addEventListener('core-complete',function(){
                    var items = ajax.response;
                    items.forEach(function(element,index){
                        var itemPage = document.createElement('rave-item-button');
                        itemPage.itemId = element;
                        itemsHolder.appendChild(itemPage);
                    });
                    
                    ajax.remove();
                }); 
                ajax.go();
            },
            hashChange: function(){
            }
        });
    </script>
</polymer-element>