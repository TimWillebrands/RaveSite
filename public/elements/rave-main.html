<link rel="import" href="/bower/polymer/polymer.html">
<link rel="import" href="/bower/core-animated-pages/core-animated-pages.html">
<link rel="import" href="/bower/core-animated-pages/transitions/slide-from-bottom.html">
<link rel="import" href="/bower/core-pages/core-pages.html">
<link rel="import" href="/bower/core-item/core-item.html">
<link rel="import" href="/bower/core-icons/core-icons.html">
<link rel="import" href="/public/elements/rave-sidebar.html">
<link rel="import" href="/public/elements/rave-item-page.html">
<link rel="import" href="/public/elements/rave-item-pages.html">
<link rel="import" href="/public/elements/rave-item-button.html">

<polymer-element name="rave-main" attributes="selected item" fit horizontal layout>
    <template>
        <style type="text/css">
            #sideBar{
                width: 15em;
                z-index: 255;
            }
            .content{
                width: 100%;
                height: 100%;        
            }
        </style>
        <rave-sidebar id="sideBar" selected="{{selected}}">
            <core-item label="Over mij" tag="home" icon="Settings"></core-item>
            <core-item label="Portfolio" tag="portfolio" icon="Dialog"></core-item>
            <core-item label="Contact" tag="contact" icon="Search"></core-item>
        </rave-sidebar>
        <core-animated-pages id="itemOrMainPage" transitions="slide-from-bottom" flex horizontal layout>
            <core-pages selected="{{selected}}" valueattr="id" flex>
                <div id="home" class="content"> HOI</div>
                <rave-item-pages id="portfolio"></rave-item-pages>
                <div id="contact" class="content">KOEL VERHAAL BROEDER</div>
            </core-pages>
            <rave-item-page id="itemPage" flex></rave-item-page>
        </core-animated-pages>
    </template>
    <script>
        var max = 1;
        
        /*global Polymer History*/
        Polymer('rave-main', {
            selected: "home",
            blockReturnFromItem: false,
            item: '',
            ready: function() {
                if(this.item !== ''){
                    this.blockReturnFromItem = true;
                    this.selectItem(JSON.parse(this.item));
                }
                this.$.sideBar.selected = this.selected;
            },
            selectedChanged: function(oldValue, newValue){
                this.returnFromItem();
            },
            selectItem: function(item){ //Single item page
                var newUrl = "/" + this.selected + "/" + item._id;
                History.pushState(null, item.title, newUrl);
                
                this.$.itemPage.itemId = item._id;
                var p = this.$.itemOrMainPage;
                
                if (p.selected === 0)
                    p.selected = 1;
            },
            returnFromItem: function(){
                if(this.blockReturnFromItem !== true){
                    History.pushState(null, this.selected, "/"+this.selected);
                    var p = this.$.itemOrMainPage;
                    
                    if (p.selected === max)
                        p.selected = 0;
                }else{
                    this.blockReturnFromItem = false;
                }
            }
        });
    </script>
</polymer-element>