<link rel="import" href="/bower/polymer/polymer.html">
<link rel="import" href="/bower/core-animated-pages/core-animated-pages.html">
<link rel="import" href="/bower/core-animated-pages/transitions/slide-from-bottom.html">
<link rel="import" href="/bower/core-pages/core-pages.html">
<link rel="import" href="/bower/core-item/core-item.html">
<link rel="import" href="/bower/core-icons/core-icons.html">
<link rel="import" href="/public/elements/rave-sidebar.html">
<link rel="import" href="/public/elements/rave-item-page.html">
<link rel="import" href="/public/elements/rave-item-pages.html">
<link rel="import" href="/public/elements/rave-item-button.html">

<polymer-element name="rave-main" attributes="selected item" fit horizontal layout>
    <template>
        <style type="text/css">
            #sideBar{
                width: 15em;
                z-index: 255;
            }
            section .content{
                background: black;
                background: rgba(0,0,0,0.4);
                border-radius: 5px;
                padding: 5em;
                color: beige;
            }
        </style>
        <rave-sidebar id="sideBar" selected="{{selected}}">
            <core-item label="Over mij" tag="home" icon="Settings"></core-item>
            <core-item label="Portfolio" tag="portfolio" icon="Dialog"></core-item>
            <core-item label="Contact" tag="contact" icon="Search"></core-item>
        </rave-sidebar>
        <core-animated-pages id="itemOrMainPage" transitions="slide-from-bottom" flex horizontal layout>
            <core-pages selected="{{selected}}" valueattr="id" flex>
                <section id="home" horizontal layout> <div style="width:10%"></div> <div class="content" flex>HOI</div> <div style="width:10%"></div> </section>
                <rave-item-pages id="portfolio"></rave-item-pages>
                <section id="contact" horizontal layout> <div style="width:10%"></div> <div class="content" flex>KOEL VERHAAL BROEDER</div> <div style="width:10%"></div> </section>
            </core-pages>
            <rave-item-page id="itemPage" flex></rave-item-page>
        </core-animated-pages>
    </template>
    <script>
    
        var max = 1;
        
        /*global Polymer History*/
        Polymer('rave-main', {
            selected: "home",
            blockReturnFromItem: false,
            item: '',
            ready: function() {
                if(this.item !== ''){
                    this.blockReturnFromItem = true;
                    this.selectItem(JSON.parse(this.item));
                }
                this.$.sideBar.selected = this.selected;
            },
            selectedChanged: function(oldValue, newValue){
                this.returnFromItem();
            },
            selectItem: function(item){ //Single item page
                var newUrl = "/" + this.selected + "/" + item._id;
                History.pushState({type: "item", value: item._id}, item.title, newUrl); 
                console.log("Item Selected");
                
                this.$.itemPage.itemId = item._id;
                var p = this.$.itemOrMainPage;
                
                if (p.selected === 0)
                    p.selected = 1;
            },
            returnFromItem: function(){
                if(this.blockReturnFromItem !== true){
                    History.pushState({type: "overview", value: this.selected}, this.selected, "/"+this.selected);
                    console.log("Back to Overview");
                    var p = this.$.itemOrMainPage;
                    
                    if (p.selected === max)
                        p.selected = 0;
                }else{
                    this.blockReturnFromItem = false;
                }
            }
        });
        
        
        window.onpopstate = function(event) {
            var state = JSON.stringify(event.state);
            console.log("state: " + state);
        };
    </script>
</polymer-element>