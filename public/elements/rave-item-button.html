<link rel="import" href="/bower/polymer/polymer.html">
<link rel="import" href="/bower/core-ajax/core-ajax.html">
<link rel="import" href="/public/fonts.html">

<polymer-element name="rave-item-button" attributes="itemId baseUrl" unresolved>
    <template>
        <style type="text/css">
            :host{
                float:left;
                position: relative;
                width: 25%;
                padding-bottom : 22.5%; /* = width for a 1:1 aspect ratio */
                background-color:#1E1E1E;
                overflow:hidden;
                font-family: 'Roboto', sans-serif;
                font-weight: 300;
            }
            a{
                position:absolute;
                width: 100%;
                height: 100%;
            }
            a #content{
                font-family: 'Roboto', sans-serif;
                font-weight:  300;
                position: absolute;
                box-sizing: border-box;
                border: rgb(126, 122, 122) 4px solid;
                color: rgb(126, 122, 122);
                padding: 1em;
                width: 100%;
                height: 100%;
                z-index: 100;
            }
            a #content h1{
                font-weight: 600;
                margin-top: 0;
                text-shadow: 1px 1px 1px black;
            }
            a #cover{
                position: absolute;
                width: 100%;
                height: 100%;
                z-index: 255;
                background: "#7e7a7a";
                /*background-image: url(/public/images/loader.gif);*/
                background-position: 50% 50%;
                background-repeat: no-repeat;
                -moz-transition: margin-top 1s;
                -o-transition: margin-top 1s;
                -webkit-transition: margin-top 1s;
                transition: margin-top 1s;
                transition-delay: .28s;
                -webkit-filter: grayscale(100%);
                -moz-filter: grayscale(100%);
                filter: grayscale(100%);
            }
            a:hover #cover{
                margin-top: 80%;
            }
            
            @media all and (min-width: 1441px) and (max-width: 1920px) {
                :host{
                    width: 33.33333333%;
                    padding-bottom : 30%; /* = width for a 1:1 aspect ratio */
                }
            }
            @media all and (min-width: 630px) and (max-width: 1440px) {
                :host{
                    width: 50%;
                    padding-bottom : 45%;
                }
            }
            @media all and (max-width: 629px) {
                :host{
                    width: 100%;
                    padding-bottom : 90%;
                }
            }
            
            #bowlG{position:relative;width:128px;height:128px;top:calc(50% - 75px);left:calc(50% - 75px)}#bowl_ringG{position:absolute;width:128px;height:128px;border:11px solid #303030;-moz-border-radius:128px;-webkit-border-radius:128px;-o-border-radius:128px;-ms-border-radius:128px;border-radius:128px}.ball_holderG{position:absolute;width:34px;height:128px;left:47px;top:0;-moz-animation-name:ball_moveG;-moz-animation-duration:1.2s;-moz-animation-iteration-count:infinite;-moz-animation-timing-function:linear;-webkit-animation-name:ball_moveG;-webkit-animation-duration:1.2s;-webkit-animation-iteration-count:infinite;-webkit-animation-timing-function:linear;-o-animation-name:ball_moveG;-o-animation-duration:1.2s;-o-animation-iteration-count:infinite;-o-animation-timing-function:linear;-ms-animation-name:ball_moveG;-ms-animation-duration:1.2s;-ms-animation-iteration-count:infinite;-ms-animation-timing-function:linear;animation-name:ball_moveG;animation-duration:1.2s;animation-iteration-count:infinite;animation-timing-function:linear}.ballG{position:absolute;left:0;top:-30px;width:51px;height:51px;background:#CCC;-moz-border-radius:43px;-webkit-border-radius:43px;-o-border-radius:43px;-ms-border-radius:43px;border-radius:43px}@-moz-keyframes ball_moveG{0%{-moz-transform:rotate(0deg)}100%{-moz-transform:rotate(360deg)}}@-webkit-keyframes ball_moveG{0%{-webkit-transform:rotate(0deg)}100%{-webkit-transform:rotate(360deg)}}@-o-keyframes ball_moveG{0%{-o-transform:rotate(0deg)}100%{-o-transform:rotate(360deg)}}@-ms-keyframes ball_moveG{0%{-ms-transform:rotate(0deg)}100%{-ms-transform:rotate(360deg)}}@keyframes ball_moveG{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}
        </style>
        <a id="link" on-tap="{{click}}" href="#">
            <div id="content">
                <h1>{{title}}</h1>
                {{description}}    
            </div>
            <div id="cover">
                <div id="bowlG">
                    <div id="bowl_ringG">
                        <div class="ball_holderG">
                            <div class="ballG"></div>
                        </div>
                    </div>
                </div>
            </div>
        </a>
    </template>
    <script>
        /*global Polymer History getMain*/
        Polymer('rave-item-button', {
            title: "Title",
            description: "Description",
            itemIdChanged: function(oldValue, newValue){
                var link = this.$.link;
                var cover = this.$.cover;
                var loader = this.$.bowlG;
                var t = this;
                link.setAttribute('href','#');
                var ajax = document.createElement('core-ajax');
                ajax.method = "GET";
                ajax.url = "/admin/item/" + newValue;
                ajax.handleAs = "json";
                ajax.contentType = "application/json";
                ajax.addEventListener('core-complete',function(){
                    var item = ajax.response;
                    cover.style.backgroundImage = "url("+item.thumbnail+")";
                    cover.style.backgroundPosition = "100% 100%"; //BAAAAADDDDD!!!!
                    cover.style.backgroundSize= "cover";
                    t.title = item.name;
                    t.description = item.description;
                    loader.remove();
                    ajax.remove();
                }); 
                ajax.go();
            },
            click: function(){
                var newUrl = "/" + this.baseUrl + "/" + this.itemId;
                History.pushState(null, this.title, newUrl);
                
                getMain().selectItem(this.itemId);
            }
        });
    </script>
</polymer-element>