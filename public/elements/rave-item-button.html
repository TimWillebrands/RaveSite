<link rel="import" href="/bower/polymer/polymer.html">
<link rel="import" href="/bower/core-ajax/core-ajax.html">

<polymer-element name="rave-item-button" attributes="itemId">
    <template>
        <link href='http://fonts.googleapis.com/css?family=Lobster' rel='stylesheet prefetch' type='text/css'>
        <style type="text/css">
            
            :host{
                float:left;
                position: relative;
                width: 25%;
                padding-bottom : 22.5%; /* = width for a 1:1 aspect ratio */
                background-color:#1E1E1E;
                overflow:hidden;
            }
            a{
                position:absolute;
                width: 100%;
                height: 100%;
            }
            a #content{
                font-family: 'Lobster', sans-serif;
                position: absolute;
                box-sizing: border-box;
                border: rgb(126, 122, 122) 4px solid;
                color: rgb(126, 122, 122);
                padding: 1em;
                width: 100%;
                height: 100%;
                z-index: 100;
            }
            a #cover{
                position: absolute;
                width: 100%;
                height: 100%;
                z-index: 255;
                background: url(http://www.mytreedb.com/uploads/mytreedb/loader/ajax_loader_gray_350.gif);
                background-position: 50% 50%;
                background-size: cover;
                background-repeat: no-repeat;
                -moz-transition: margin-top 1s;
                -o-transition: margin-top 1s;
                -webkit-transition: margin-top 1s;
                transition: margin-top 1s;
            }
            a:hover #cover{
                margin-top: 80%;
            }
            
            @media all and (min-width: 1000px) and (max-width: 1700px) {
                :host{
                    width: 33.33333333%;
                    padding-bottom : 30%; /* = width for a 1:1 aspect ratio */
                }
            }
            @media all and (min-width: 630px) and (max-width: 999px) {
                :host{
                    width: 50%;
                    padding-bottom : 45%;
                }
            }
            @media all and (max-width: 629px) {
                :host{
                    width: 100%;
                    padding-bottom : 90%;
                }
            }
        </style>
        <a id="link" href="#">
            <div id="content">
                <h2>{{title}}</h2>
                {{description}}    
            </div>
            <div id="cover"></div>
        </a>
    </template>
    <script>
        /*global Polymer*/
        Polymer('rave-item-button', {
            title: "Title",
            description: "Description",
            itemIdChanged: function(oldValue, newValue){
                var link = this.$.link;
                var cover = this.$.cover;
                var t = this;
                link.setAttribute('href','#'+newValue);
                var ajax = document.createElement('core-ajax');
                ajax.method = "GET";
                ajax.url = "/admin/item/" + newValue;
                ajax.handleAs = "json";
                ajax.contentType = "application/json";
                ajax.addEventListener('core-complete',function(){
                    var item = ajax.response;
                    cover.style.backgroundImage = "url("+item.thumbnail+")";
                    cover.style.backgroundPosition= "100% 100%";
                    t.title = item.name;
                    t.description = item.description;
                    ajax.remove();
                }); 
                ajax.go();
            },
            hover: function(){
                console.log("ASD");
            }
        });
    </script>
</polymer-element>