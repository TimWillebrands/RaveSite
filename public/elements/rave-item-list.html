<link rel="import" href="/bower/polymer/polymer.html">
<link rel="import" href="/bower/core-selector/core-selector.html">
<link rel="import" href="/public/elements/rave-item.html">

<polymer-element name="rave-item-list">
    <template>
        <style type="text/css">
            core-header-panel{margin:1em;background:#4F618F}core-toolbar{background:#A9B3CD}#daContent>.selected{font-weight:700;background:#A9B3CD}
        </style>
        <core-header-panel flex mode="waterfall">
            <core-toolbar>Items</core-toolbar>
            <core-selector id="daContent" style="padding: 1em;" on-core-select="{{ selectAction }}"></core-selector>
        </core-header-panel>
    </template>
    <script>
        /*global Polymer*/
        Polymer('rave-item-list', {
            domReady: function(){
                this.updateList();
            },
            updateList: function(){
                var ajax = document.createElement('core-ajax');
                var content = this.$.daContent;
                ajax.method = "GET";
                ajax.url = "/admin/item";
                ajax.addEventListener('core-complete',function(){
                    var items = JSON.parse(ajax.response);
                    for(var i=0; i<items.length; i++) {
                        var newItem  = document.createElement('rave-item');
                        newItem.name = items[i].name;
                        newItem.description = items[i].description;
                        newItem.thumbnail = items[i].thumbnail;
                        newItem.photos = items[i].photos;
                        content.appendChild(newItem);
                    }
                    ajax.remove();
                }); 
                ajax.go();
            },
            selectAction: function(e, detail, sender) {
                console.log("Item list: ",this.getItemList());
                detail.item.toggleSelection(detail.isSelected);
                if(detail.isSelected){
                    this.parentNode.getElementsByTagName("rave-item-toolbar")[0].selected = detail.item;
                }
            },
            getItemList: function(){
                return this.$.daContent.items;
            }
        });
    </script>
</polymer-element>